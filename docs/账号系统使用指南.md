# Study Quest 账号系统使用指南

## ✨ 新增功能

### 1. 用户注册与登录
- ✅ 支持用户名密码注册
- ✅ 学生/家长角色选择
- ✅ Session 认证机制
- ✅ 自动登录保持（LocalStorage）

### 2. 学生列表管理
- ✅ 家长可查看家庭内所有学生
- ✅ 显示学生姓名、用户名、年级、积分

### 3. 积分排行榜
- ✅ 全局 Top 10 学生排名
- ✅ 按积分从高到低排序
- ✅ 前三名特殊标识（金银铜）

## 🚀 快速开始

### 访问系统
打开浏览器访问：**http://localhost:8080/web**

### 使用预设账号登录

#### 学生账号
- **用户名**: `student1`
- **密码**: `123456`
- **角色**: 学生
- **积分**: 100

#### 家长账号
- **用户名**: `parent1`
- **密码**: `123456`
- **角色**: 家长

### 注册新账号
1. 在登录页面点击"没有账号？点击注册"
2. 填写注册信息：
   - 用户名（至少3个字符）
   - 密码（至少6个字符）
   - 真实姓名
   - 角色（学生/家长）
   - 年级（学生需要选择）
3. 点击"注册"按钮
4. 注册成功后返回登录页面

## 📱 功能详解

### 学生端功能
1. **查看积分**
   - 登录后在顶部显示当前积分
   - 实时更新

2. **今日任务**
   - 查看分配的任务列表
   - 提交任务（状态变为"审核中"）
   - 查看任务状态（待办/审核中/已完成）

3. **积分兑换**
   - 使用积分兑换奖励
   - 兑换成功后自动扣除积分
   - 积分不足时提示

### 家长端功能
1. **任务审核**
   - 查看待审核任务列表
   - 通过/驳回学生提交的任务
   - 审核通过后自动给学生增加积分

2. **发布任务**
   - 输入任务名称和积分值
   - 发布后自动分配给家庭内学生

3. **家庭成员**
   - 查看家庭内所有学生信息
   - 显示每个学生的当前积分

### 排行榜
- **全局排名**: 显示所有学生的积分排名
- **前三名**: 金🥇、银🥈、铜🥉 特殊标识
- **实时更新**: 积分变化后排名自动更新

## 🔐 安全特性

### 认证机制
- 所有核心接口需要登录认证
- Token 自动存储在 LocalStorage
- Session 有效期 24 小时
- 退出登录自动清除 Token

### 数据隔离
- 学生只能看到自己的任务和积分
- 家长可以看到家庭内所有学生信息
- 排行榜所有人可见（不需要登录）

## 📊 API 接口

### 认证接口（无需 Token）
```
POST /api/v1/auth/register  # 用户注册
POST /api/v1/auth/login     # 用户登录
POST /api/v1/auth/logout    # 退出登录
GET  /api/v1/ranking        # 获取排行榜
```

### 受保护接口（需要 Token）
```
GET  /api/v1/profile            # 获取当前用户信息
GET  /api/v1/tasks/today        # 获取今日任务
GET  /api/v1/tasks/pending      # 获取待审核任务
POST /api/v1/tasks/create       # 创建任务
POST /api/v1/tasks/submit       # 提交任务
POST /api/v1/tasks/approve      # 审核任务
POST /api/v1/rewards/redeem     # 兑换奖励
GET  /api/v1/students           # 获取家庭学生列表
```

## 🎯 使用场景

### 场景 1: 学生完成作业获得积分
1. 学生登录系统
2. 查看"今日任务"列表
3. 完成作业后点击"提交完成"
4. 等待家长审核
5. 家长审核通过后自动获得积分

### 场景 2: 家长审核任务
1. 家长登录系统
2. 切换到"家长端"
3. 在"待审核任务"中查看学生提交
4. 确认后点击"通过"
5. 学生账户自动增加对应积分

### 场景 3: 学生兑换奖励
1. 学生登录并积累足够积分
2. 在"积分兑换"区域选择奖励
3. 点击"兑换"按钮
4. 积分自动扣除
5. 找家长领取实际奖励

### 场景 4: 查看排名
1. 点击顶部"排行榜 🏆"
2. 查看自己的排名
3. 看到其他同学的积分
4. 激励自己努力完成更多任务

## 🔧 技术架构

### 前端
- 单页应用（SPA）
- LocalStorage 存储 Token
- 自动认证和路由守卫

### 后端
- Session 认证机制
- Token 有效期管理
- 中间件拦截未认证请求

### 数据模型
```go
type User struct {
    ID       uint
    Username string
    Password string  // 生产环境需加密
    Role     string  // student/parent
    Points   int
    FamilyID uint    // 家庭组
    Grade    int     // 年级
    RealName string  // 真实姓名
}

type Session struct {
    Token     string
    UserID    uint
    ExpiresAt time.Time
}
```

## 🐛 常见问题

### Q1: 登录后刷新页面需要重新登录？
**A**: 系统已实现自动登录，刷新页面会自动验证 Token 并恢复登录状态。

### Q2: 忘记密码怎么办？
**A**: 当前版本为演示版，暂不支持密码找回。可以重新注册新账号。

### Q3: 学生列表为空？
**A**: 确保家庭内有注册的学生账号。默认情况下，所有新注册用户都在同一个家庭（FamilyID=1）。

### Q4: 排行榜不显示自己？
**A**: 排行榜只显示学生角色的用户。家长账号不会出现在排行榜中。

### Q5: 积分更新不及时？
**A**: 切换标签页后会自动刷新数据。也可以手动刷新浏览器页面。

## 📈 未来规划

- [ ] 密码加密存储（bcrypt）
- [ ] 邮箱验证和密码找回
- [ ] 多家庭支持（创建和加入家庭）
- [ ] 头像上传
- [ ] 任务分类和标签
- [ ] 周/月积分统计
- [ ] 成就勋章系统
- [ ] 消息通知功能

## 📞 技术支持

如有问题，请查看：
- 后端日志：`logs/backend.log`
- 浏览器控制台（F12）

---

**最后更新**: 2025-12-12  
**版本**: v1.1.0

